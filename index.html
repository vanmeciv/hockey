<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NHL Regulation Rink + Event Logger (0.1s)</title>

<style>
  body { margin:0; background:#0b0f14; color:#e5e7eb; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
  header { padding:12px; border-bottom:1px solid #1f2937; background:#0b0f14; position:sticky; top:0; z-index:5; }
  .row { display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; }
  .clock { font-size:28px; font-weight:800; letter-spacing:0.5px; }
  .btnRow { display:flex; gap:8px; flex-wrap:wrap; }
  button { background:#1f2937; color:#e5e7eb; border:0; border-radius:10px; padding:10px 12px; font-weight:700; cursor:pointer; }
  button:active { background:#374151; }

  main { padding:12px 12px 210px; }
  #rink { width:100%; height:auto; background:#0b1220; border-radius:18px; border:1px solid #1f2937; touch-action:manipulation; }

  .hint { font-size:12px; color:#9ca3af; margin-top:6px; }
  .events { margin-top:12px; display:flex; flex-direction:column; gap:6px; }
  .event { background:#111827; border:1px solid #1f2937; border-radius:10px; padding:6px 8px; font-size:14px; display:flex; gap:8px; align-items:center; }
  .event strong { width:18px; display:inline-flex; justify-content:center; }

  .controls { position:fixed; bottom:0; left:0; right:0; padding:12px; background:#0b0f14; border-top:1px solid #1f2937; z-index:10; }
  .grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; }
  .timeGrid { display:grid; grid-template-columns:repeat(6,1fr); gap:8px; margin-top:10px; }
  .timeGrid button { padding:10px 8px; }

  .toast {
    position:fixed; left:12px; right:12px; bottom:220px;
    background:#0b1220; border:1px solid #1f2937; border-radius:12px;
    padding:10px; font-weight:700; display:none; z-index:20;
  }
  .toast.show { display:block; }
</style>
</head>

<body>

<header>
  <div class="row">
    <div class="clock" id="clock">20:00.0</div>
    <div class="btnRow">
      <button id="startStop">Start</button>
      <button id="undo">Undo</button>
      <button id="clearPending">Clear “place”</button>
    </div>
  </div>
</header>

<main>

<!-- ===== NHL REGULATION RINK (1 unit = 1 foot; viewBox 200 x 85) ===== -->
<svg id="rink" viewBox="0 0 200 85" preserveAspectRatio="xMidYMid meet" aria-label="NHL regulation rink (feet)">
  <!-- Boards -->
  <rect x="0" y="0" width="200" height="85" rx="28" ry="28"
        fill="none" stroke="#e5e7eb" stroke-width="0.8"/>

  <!-- Goal lines (2" wide = 0.1667') at x=11 and x=189 (centered) -->
  <rect x="10.9167" y="0" width="0.1667" height="85" fill="#ef4444"/>
  <rect x="188.9167" y="0" width="0.1667" height="85" fill="#ef4444"/>

  <!-- Blue lines (12" wide = 1') centered at x=75 and x=125 -->
  <rect x="74.5"  y="0" width="1" height="85" fill="#3b82f6"/>
  <rect x="124.5" y="0" width="1" height="85" fill="#3b82f6"/>

  <!-- Center red line (12" wide = 1') -->
  <rect x="99.5" y="0" width="1" height="85" fill="#ef4444"/>

  <!-- Center faceoff circle (15' radius) + center dot (12" diameter => r=0.5') -->
  <circle cx="100" cy="42.5" r="15" fill="none" stroke="#3b82f6" stroke-width="0.1667"/>
  <circle cx="100" cy="42.5" r="0.5" fill="#3b82f6"/>

  <!-- Neutral-zone faceoff spots: diameter 2' (r=1'), 5' from each blue line, 44' apart across width -->
  <!-- y = 42.5 ± 22 => 20.5 and 64.5; x = 80 (75+5) and 120 (125-5) -->
  <g fill="none" stroke="#ef4444" stroke-width="0.1667">
    <circle cx="80"  cy="20.5" r="1"/><circle cx="80"  cy="64.5" r="1"/>
    <circle cx="120" cy="20.5" r="1"/><circle cx="120" cy="64.5" r="1"/>
  </g>

  <!-- End-zone faceoff circles: radius 15'; centers: x = 31 and 169; y = 20.5 and 64.5 -->
  <g fill="none" stroke="#ef4444" stroke-width="0.1667">
    <circle cx="31"  cy="20.5" r="15"/><circle cx="31"  cy="64.5" r="15"/>
    <circle cx="169" cy="20.5" r="15"/><circle cx="169" cy="64.5" r="15"/>
  </g>

  <!-- End-zone faceoff dots: diameter 2' (r=1') -->
  <g fill="#ef4444">
    <circle cx="31"  cy="20.5" r="1"/><circle cx="31"  cy="64.5" r="1"/>
    <circle cx="169" cy="20.5" r="1"/><circle cx="169" cy="64.5" r="1"/>
  </g>

  <!-- Goal creases (outline per your approved geometry) -->
  <path d="M 11 38.5 L 15.5 38.5 A 6 6 0 0 1 15.5 46.5 L 11 46.5"
        fill="none" stroke="#ef4444" stroke-width="0.1667"/>
  <path d="M 189 38.5 L 184.5 38.5 A 6 6 0 0 0 184.5 46.5 L 189 46.5"
        fill="none" stroke="#ef4444" stroke-width="0.1667"/>

  <!-- Goal dots (simple) -->
  <circle cx="20"  cy="42.5" r="1" fill="#ef4444"/>
  <circle cx="180" cy="42.5" r="1" fill="#ef4444"/>

  <!-- Event markers (on top) -->
  <g id="markers"></g>
</svg>

<div class="hint" id="hint">Tap an event button, then tap the rink to place it (optional).</div>
<div class="events" id="events"></div>

</main>

<div class="toast" id="toast"></div>

<div class="controls">
  <div class="grid">
    <button data-type="goal">GOAL</button>
    <button data-type="shot">SHOT</button>
    <button data-type="hit">HIT</button>
    <button data-type="penalty">PENALTY</button>
    <button data-type="possession">POSSESSION</button>
    <button data-type="note">NOTE</button>
  </div>

  <!-- Time adjust: tenths-based -->
  <div class="timeGrid">
    <button data-dt="-600">-60s</button>
    <button data-dt="-100">-10s</button>
    <button data-dt="-10">-1s</button>
    <button data-dt="10">+1s</button>
    <button data-dt="100">+10s</button>
    <button data-dt="600">+60s</button>

    <button data-dt="-1">-0.1s</button>
    <button data-dt="1">+0.1s</button>
    <button id="set2000">Set 20:00.0</button>
    <button id="set1500">Set 15:00.0</button>
    <button id="set0500">Set 05:00.0</button>
    <button id="stop">Stop</button>
  </div>
</div>

<script>
/* ===== Symbols per event type ===== */
const SYMBOL = {
  goal: "●",
  shot: "△",
  hit: "✖",
  penalty: "▢",
  possession: "⇄",
  note: "✎"
};

/* ===== State: time in tenths ===== */
const state = {
  clockTenths: 20 * 60 * 10,
  running: false,
  events: [],
  pendingEvent: null
};

const rink = document.getElementById("rink");
const markers = document.getElementById("markers");
const eventsEl = document.getElementById("events");
const toast = document.getElementById("toast");
const hint = document.getElementById("hint");

function formatTime(tenths) {
  const totalSeconds = Math.floor(tenths / 10);
  const t = tenths % 10;
  const m = Math.floor(totalSeconds / 60);
  const s = totalSeconds % 60;
  return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}.${t}`;
}

function showToast(msg) {
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 1800);
}

function render() {
  document.getElementById("clock").textContent = formatTime(state.clockTenths);

  eventsEl.innerHTML = state.events.map(e => {
    const sym = SYMBOL[e.type] ?? "?";
    const placed = e.xy ? " • placed" : "";
    return `<div class="event" title="Tap button then tap rink to place">
      <strong>${sym}</strong>
      <span>${e.type.toUpperCase()} @ ${formatTime(e.time)}${placed}</span>
    </div>`;
  }).join("");

  markers.innerHTML = "";
  for (const e of state.events) {
    if (!e.xy) continue;

    const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
    t.setAttribute("x", e.xy.x);
    t.setAttribute("y", e.xy.y);
    t.setAttribute("font-size", "4");
    t.setAttribute("fill", "#e5e7eb");
    t.setAttribute("text-anchor", "middle");
    t.setAttribute("dominant-baseline", "middle");
    t.textContent = SYMBOL[e.type] ?? "?";
    markers.appendChild(t);
  }
}

/* ===== Log event (arm placement) ===== */
document.querySelectorAll(".grid button").forEach(btn => {
  btn.addEventListener("click", () => {
    const evt = { type: btn.dataset.type, time: state.clockTenths, xy: null };
    state.events.unshift(evt);
    state.pendingEvent = evt;
    hint.textContent = "Now tap the rink to place that event (optional).";
    showToast(`${(SYMBOL[evt.type] ?? "?")} ${evt.type.toUpperCase()} logged`);
    render();
  });
});

/* ===== Place event on rink ===== */
rink.addEventListener("click", (e) => {
  if (!state.pendingEvent) return;

  const r = rink.getBoundingClientRect();
  const x = (e.clientX - r.left) / r.width * 200; // feet coords
  const y = (e.clientY - r.top) / r.height * 85;

  state.pendingEvent.xy = { x, y };
  state.pendingEvent = null;

  hint.textContent = "Tap an event button, then tap the rink to place it (optional).";
  showToast("Placed");
  render();
});

/* ===== Clock controls ===== */
document.getElementById("startStop").addEventListener("click", () => {
  state.running = !state.running;
  showToast(state.running ? "Running" : "Paused");
});

document.getElementById("stop").addEventListener("click", () => {
  state.running = false;
  showToast("Stopped");
});

document.getElementById("undo").addEventListener("click", () => {
  state.events.shift();
  render();
});

document.getElementById("clearPending").addEventListener("click", () => {
  state.pendingEvent = null;
  hint.textContent = "Tap an event button, then tap the rink to place it (optional).";
  showToast("Cleared pending placement");
  render();
});

/* ===== Time adjust ===== */
document.querySelectorAll(".timeGrid button[data-dt]").forEach(btn => {
  btn.addEventListener("click", () => {
    const dt = Number(btn.dataset.dt);
    state.clockTenths = Math.max(0, state.clockTenths + dt);
    render();
  });
});

document.getElementById("set2000").addEventListener("click", () => { state.clockTenths = 20*60*10; render(); });
document.getElementById("set1500").addEventListener("click", () => { state.clockTenths = 15*60*10; render(); });
document.getElementById("set0500").addEventListener("click", () => { state.clockTenths =  5*60*10; render(); });

/* ===== Tick every 0.1s ===== */
setInterval(() => {
  if (state.running && state.clockTenths > 0) {
    state.clockTenths--;
    render();
  }
}, 100);

render();
</script>

</body>
</html>
